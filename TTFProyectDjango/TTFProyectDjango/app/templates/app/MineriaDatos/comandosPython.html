{% extends "app/plantillaBase.html" %}

{% block content %}
<h2>{{title}}</h2>

<section class="pyscript">
    <py-config>
        packages = [
            "pandas",
            "seaborn",
            "matplotlib",
            "scipy",
        ]
        plugins = [
            "https://pyscript.net/latest/plugins/python/py_tutor.py"
        ]
    </py-config>
    <py-tutor>
        <py-script>

            # Obtencion archivos
            import pandas as pd
            from pyodide.http import open_url
            from scipy.io import arff
            import seaborn as sns
            import matplotlib.pyplot as plt
            
            # Fase 1. Obtencion y analisis de informacion

            # Obtencion dataset titanic
            
            def cargarTitanic():
                df = pd.read_csv(open_url("https://raw.githubusercontent.com/p72losaj/Datasets/main/titanic.csv"))
                return df

            # Obtencion dataset iris

            def cargarIris():
                df = pd.read_csv(
                                    open_url("https://raw.githubusercontent.com/p72losaj/Datasets/main/iris.data"), 
                                    header=None, 
                                    names = ["sepal length","sepal width","petal length","petal width","Species"])
                return df

            # Obtencion dataset segment challenge

            def cargarSegmentChallenge():
                
                segment_challenge = pd.DataFrame(arff.loadarff(open_url("https://raw.githubusercontent.com/p72losaj/Datasets/main/segment-challenge.arff"))[0])
                segment_challenge['class'] = segment_challenge['class'].str.decode('utf-8')
                
                return segment_challenge

            # Funcion que muestra el dataset
            
            def showDataset(df, nombreDataset):
                display("Mostrando el dataset: " + nombreDataset)
                display(df)
                return df

            # Funcion que muestra la informacion del dataset
            
            def showInfoDataset(df):
                display("Mostrando la informacion del dataset: ")
                display(df.info())
                return df

            # Funcion que muestra la correlacion de las columnas del dataset
            
            def corrDataset(df):
                display("Correlacion columnas dataset")
                display(df.corr(numeric_only=True))
                return df

            # Funcion que muestra un analisis estadistico del dataset
            
            def analisisEstadisticoDataset(df):
                display("Analisis estadistico del dataset")
                display(df.describe())
                return df

            # Funcion que muestra las clases del dataset
            
            def showClases(df, clase):
                sns.countplot(x=clase, data=df)
                plt.title("Clases del dataset")
                display(plt)
                plt.clf()
                return df

            # Funcion que muestra la distribucion de los datos del dataset para una columna dada
            
            def distribucionDatosColumnaDataset(df, etiqueta, clase):
                display("Mostrando la distribucion de los datos del dataset")
                sns.displot(df, x=etiqueta, col=clase)
                display(plt)
                plt.clf()
                return df
            

            # Fase 2. Limpieza de datos

            # Consideraciones dataset titanic
            # 1) Establecer meta: Predecir supervivencia de los pasajeros => Atributo clave sera Survived
            # 2) Separar etiquetas de los datos
            # 3) ¿Variables categoricas / diferentes niveles? Atributos Sex y Embarked => Transformamos a variables numericas
            # 4) Variables numericos se mantienen
            # 5) Eliminamos atributos con poco relevancia

            # Funcion que elimina atributos del dataset con poca relevancia

            def eliminarColumnas(df, cols):
                df.drop(cols, axis=1, inplace=True)
                return df

            # Funcion principal
            def main():
                titanic.pipe(showDataset, "TitanicOriginal")
                titanic2 = titanic.copy().pipe(eliminarColumnas, ['PassengerId', 'Name', 'Ticket', 'Cabin']).pipe(showDataset, "TitanicCopia")
                display("Variables categoricas: " + titanic2.dtypes[titanic2.dtypes == "object"].index)

            if __name__ == "__main__":
                # Cargamos los conjuntos de datos
                iris, titanic, segment_challenge = cargarIris(), cargarTitanic(), cargarSegmentChallenge()
                main()
        </py-script>
    </py-tutor>

</section>

{% endblock %}
