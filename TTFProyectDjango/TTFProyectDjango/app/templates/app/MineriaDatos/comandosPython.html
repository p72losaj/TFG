{% extends "app/plantillaBase.html" %}

{% block content %}
<h2>{{title}}</h2>

<section class="pyscript">
    <py-config>
        packages = [
            "pandas",
            "seaborn",
            "matplotlib",
            "scipy",
        ]
        plugins = [
            "https://pyscript.net/latest/plugins/python/py_tutor.py"
        ]
    </py-config>
    <py-tutor>
        <py-script>

            # Packetes python
            import pandas as pd
            from pyodide.http import open_url
            import seaborn as sns
            import matplotlib.pyplot as plt
            from scipy.io import arff

            # Obtencion dataset titanic
            def cargarTitanic(df):
                df = pd.read_csv(open_url("https://raw.githubusercontent.com/p72losaj/Datasets/main/titanic.csv"))
                return df

            # Obtencion dataset iris
            def cargarIris(df):
                df = pd.read_csv(
                                    open_url("https://raw.githubusercontent.com/p72losaj/Datasets/main/iris.data"), 
                                    header=None, 
                                    names = ["sepal length","sepal width","petal length","petal width","Species"])
                return df

            # Funcion que carga los datasets

            def cargarDatasets():
                # Dataset iris
                iris = pd.read_csv(open_url("https://raw.githubusercontent.com/p72losaj/Datasets/main/iris.data"), 
                                                header=None, 
                                                names=["sepal length","sepal width","petal length","petal width","Species"])
                # Dataset titanic
                titanic = pd.read_csv(open_url("https://raw.githubusercontent.com/p72losaj/Datasets/main/titanic.csv"))

                # Dataset segment challenge
                segment_challenge = pd.DataFrame(arff.loadarff(open_url("https://raw.githubusercontent.com/p72losaj/Datasets/main/segment-challenge.arff"))[0])
                
                # Correccion error escritura al transformar archivo arff en dataframe de pandas
                segment_challenge['class'] = segment_challenge['class'].str.decode('utf-8')
                
                return iris,titanic, segment_challenge

            # Funcion que muestra el dataset
            
            def showDataset(df):
                display("Dataset: ")
                display(df)
                return df
            
            # Funcion que muestra la informacion del dataset
            
            def showInfoDataset(df):
                display("Mostrando la informacion del dataset: ")
                display(df.info())
                return df

            # Funcion que muestra la correlacion de las columnas del dataset
            
            def corrDataset(df):
                display("Correlacion columnas dataset")
                display(dataset.corr(numeric_only=True))
                return df

            # Funcion que muestra un analisis estadistico del dataset
            
            def analisisEstadisticoDataset(df):
                display("Analisis estadistico del dataset")
                display(df.describe())
                return df

            # Funcion que muestra las clases del dataset
            
            def showClases(df, clase):
                sns.countplot(x=clase, data=df)
                plt.title("Clases del dataset")
                display(plt)
                plt.clf()
                return df

            # Funcion que muestra la distribucion de los datos del dataset para una columna dada
            
            def distribucionDatosColumnaDataset(df, etiqueta, clase):
                display("Mostrando la distribucion de los datos del dataset")
                sns.displot(df, x=etiqueta, col=clase)
                display(plt)
                plt.clf()
                return df

            # Eliminamos columnas innecesarias dataset
            
            def drop_cols(df,cols):
                df.drop(cols, axis=1, inplace=True)
                return df

            # Visualizamos los datos nulos

            def visualizarDatosNulos(df):
                # Porcentaje de valores nulos
                display("Porcentaje de valores nulos: ")
                missing_values = df.isnull().sum()
                display(missing_values[missing_values > 0]/len(df)*100)
                # Grafica de valores nulos
                sns.heatmap(df.isnull(), yticklabels=False, cbar=False)
                plt.title("Datos nulos")
                display(plt)
                plt.clf()
                return df
            
            # Funcion que rellena los valores nulos usando la moda

            def rellenarValoresNulos(df, string):
                df[string] = df[string].fillna(df[string].mode()[0])
                return df
            
            # Funcion principal
            def main():

                # Procesamiento del dataset titanic
                titanic2 = titanic.pipe(cargarTitanic).pipe(
                                                                drop_cols, 
                                                                ['PassengerId','Name','Ticket','Cabin','Embarked']).pipe(visualizarDatosNulos).pipe(
                                                                rellenarValoresNulos, 'Age')
                titanic2.pipe(visualizarDatosNulos)
            if __name__ == "__main__":
                iris,titanic,segment_challenge = cargarDatasets()
                main()
        </py-script>
    </py-tutor>

</section>

{% endblock %}
